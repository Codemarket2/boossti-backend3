{"version":3,"file":"getConditionPartValue.js","sourceRoot":"","sources":["getConditionPartValue.ts"],"names":[],"mappings":"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","sourcesContent":["import { ConditionPart, IForm } from '../types/form';\r\nimport { IResponse } from '../types/response';\r\nimport { ResponseModel } from '../utils/responseModel';\r\nimport { getValue } from '../utils/variables';\r\n\r\ninterface GetLeftPartValuePayload {\r\n  conditionPart: ConditionPart;\r\n  forms: { [key: string]: IForm };\r\n  response?: IResponse;\r\n  responseId?: string;\r\n}\r\n\r\nexport const getLeftPartValue = async ({\r\n  conditionPart,\r\n  forms,\r\n  response: tempResponse,\r\n  responseId,\r\n}: GetLeftPartValuePayload) => {\r\n  let value;\r\n  let response;\r\n  if (tempResponse?._id) {\r\n    response = tempResponse;\r\n  } else if (responseId) {\r\n    response = await ResponseModel.findOne({ _id: responseId }).lean();\r\n  }\r\n\r\n  if (conditionPart?.fieldId === 'createdBy') {\r\n    value = response?.createdBy?._id?.toString();\r\n  } else if (conditionPart?.fieldId === 'createdAt') {\r\n    value = response?.createdAt;\r\n  } else if (conditionPart?.fieldId === '_id') {\r\n    value = response?._id?.toString();\r\n  } else {\r\n    const form = forms?.[conditionPart?.formId];\r\n    const field = form?.fields?.find((f) => f?._id?.toString() === conditionPart?.fieldId);\r\n    const fieldValue = response?.values?.find(\r\n      (v) => v?.field?.toString() === conditionPart?.fieldId,\r\n    );\r\n    if (conditionPart?.subField?.fieldId) {\r\n      let childResponseId = fieldValue?.response?._id;\r\n      if (!field?.options?.selectItem && field?.options?.dependentRelationship) {\r\n        const dependantResponse = await ResponseModel.findOne({\r\n          formId: conditionPart?.subField?.formId,\r\n          parentResponseId: response?._id,\r\n        })?.lean();\r\n        if (dependantResponse?._id) {\r\n          childResponseId = dependantResponse?._id;\r\n        }\r\n      }\r\n      value = await getLeftPartValue({\r\n        forms,\r\n        conditionPart: conditionPart?.subField,\r\n        responseId: childResponseId,\r\n      });\r\n    } else {\r\n      if (field?._id && fieldValue) {\r\n        value = getValue(field, fieldValue);\r\n      }\r\n    }\r\n  }\r\n  return value;\r\n};\r\n\r\nexport const getRightPartValue = ({ conditionPart, forms, responses, authState }) => {\r\n  let rightValue;\r\n\r\n  if (conditionPart?.value && conditionPart?.value?.includes('auth.')) {\r\n    if (conditionPart?.value === 'auth._id') {\r\n      rightValue = authState?._id;\r\n    } else if (conditionPart?.value === 'auth.name') {\r\n      rightValue = authState?.name;\r\n    } else if (conditionPart?.value === 'auth.email') {\r\n      rightValue = authState?.email;\r\n    }\r\n  } else if (conditionPart?.value === 'constantValue' && conditionPart?.constantValue) {\r\n    rightValue = conditionPart?.constantValue;\r\n  } else if (\r\n    conditionPart?.value === 'form' &&\r\n    conditionPart?.formId &&\r\n    conditionPart?.fieldId &&\r\n    conditionPart?.responseId\r\n  ) {\r\n    const form = forms?.[conditionPart?.formId];\r\n    const response = responses?.[conditionPart?.responseId];\r\n    if (conditionPart?.fieldId === 'createdBy') {\r\n      rightValue = response?.createdBy?._id?.toString();\r\n    } else if (conditionPart?.fieldId === 'createdAt') {\r\n      rightValue = response?.createdAt;\r\n    } else if (conditionPart?.fieldId === '_id') {\r\n      rightValue = response?._id?.toString();\r\n    } else {\r\n      const field = form?.fields?.find(\r\n        (f) => f?._id?.toString() === conditionPart?.fieldId?.toString(),\r\n      );\r\n      const fieldValue = response?.values?.find(\r\n        (v) => v?.field?.toString() === conditionPart?.fieldId?.toString(),\r\n      );\r\n      if (field?._id && fieldValue) {\r\n        rightValue = getValue(field, fieldValue);\r\n      }\r\n    }\r\n  }\r\n\r\n  return rightValue;\r\n};\r\n"]}